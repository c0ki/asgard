<dataConfig>
    <dataSource type="FileDataSource" encoding="UTF-8" name="file-datasource"/>
    <!--<script><![CDATA[-->
        <!--function parse(row)-->
        <!--{-->
            <!--var rawLine = row.get("rawLine")-->
            <!--// Split the rawLine-->
            <!--// And for each field-->
            <!--row.put('server_s', row.get('filename_s'));-->
            <!--return row;-->
        <!--}-->
    <!--]]></script>-->
    <document>
        <!--<entity name="f" processor="FileListEntityProcessor" baseDir="/var/www/asgard/resources/indexes" fileName=".*log"-->
        <!--newerThan="'NOW-3DAYS'" recursive="true" rootEntity="false" dataSource="null">-->
        <entity name="file" processor="FileListEntityProcessor" baseDir="/var/www/asgard/resources/indexes"
                fileName=".*log"
                rootEntity="false" dataSource="null" transformer="TemplateTransformer">
            <entity onError="skip" name="line"
                    processor="LineEntityProcessor"
                    acceptLineRegex="^.+$"
                    skipLineRegex="^\s*$"
                    url="${file.fileAbsolutePath}"
                    rootEntity="true"
                    transformer="TemplateTransformer,RegexTransformer,DateFormatTransformer"
                    dataSource="fds"
                    >
                <!--script:parse-->
                <field column="id" template="${file.file}:${line.rawLine}"/>
                <field column="filename_s" template="${file.file}" regex="^(.*)\.(.*)\.log$" groupNames="server,type"/>

                <!--126.6.101.81 - - [23/Oct/2015:10:20:08 +0200] "GET /portail/display/ HTTP/1.1" 500 206 "http://126.7.113.72:8080/portail/display/" "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:41.0) Gecko/20100101 Firefox/41.0"-->
                <field column="rawLine" name="line"
                       regex="^([^\s]+) - (.*)- \[([^\]]+)\] &quot;(\w+) ([^\s]+) ([^\s]+)&quot; (\d+) (\d+) &quot;([^&quot;]+)&quot; &quot;([^&quot;]+)&quot;"
                       groupNames="fromip_s,unknown_s,date_s,method_s,url_s,vhttp_s,codehttp_s,size_s,referer_s,browser_s"/>
                <field column="date" sourceColName="date_s" dateTimeFormat="dd/MMM/yyyy:HH:mm:ss Z" />
            </entity>
            <!--<entity name="x" processor="XPathEntityProcessor" forEach="/the/record/xpath" url="${f.fileAbsolutePath}">-->
            <!--<field column="full_name" xpath="/field/xpath"/>-->
            <!--</entity>-->
        </entity>
    </document>
</dataConfig>